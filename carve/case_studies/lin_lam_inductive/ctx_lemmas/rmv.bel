%------------------------------------------------------%
% Removal
%------------------------------------------------------%

%------------------------------------------------------%
% LkupExh
%------------------------------------------------------%

% If LkupExh [Î¨,x:tm âŠ¢ cons Î”[..] x T[] ğŸ™] [Î¨,x:tm âŠ¢ X] [ âŠ¢ T'] [ âŠ¢ ğŸ™]
% then exh(Î”), X = x, and T' = T

rec lkup_weak : LkupExh [Î¨ âŠ¢ Î”] [Î¨ âŠ¢ X] [ âŠ¢ A]
â†’ LkupExh [Î¨,x:tm âŠ¢ cons Î”[..] x B[] ğŸ˜] [Î¨,x:tm âŠ¢ X[..]] [ âŠ¢ A] =
  / total /
  fn l â‡’
  let Lkp/exh rm ex = l in
  Lkp/exh (Rmv/c rm) (Exh/c ex)
  ;

inductive LkupStrT : (Î¨:tctx) [Î¨ âŠ¢ lctx] â†’ [Î¨,x:tm âŠ¢ tm] â†’ [ âŠ¢ tp] â†’ ctype = 
  | Lkp/str : LkupExh [Î¨ âŠ¢ Î”] [Î¨ âŠ¢ X] [ âŠ¢ A]
    â†’ LkupStrT [Î¨ âŠ¢ Î”] [Î¨,x:tm âŠ¢ X[..]] [ âŠ¢ A];

rec lkup_str_top : LkupExh [Î¨,x:tm âŠ¢ cons Î”[..] x B[] ğŸ˜] [Î¨,x:tm âŠ¢ X] [ âŠ¢ A]
â†’ LkupStrT [Î¨ âŠ¢ Î”] [Î¨,x:tm âŠ¢ X] [ âŠ¢ A] =
  / total /
  fn l â‡’
  let Lkp/exh (Rmv/c rm) (Exh/c ex) = l in
  Lkp/str (Lkp/exh rm ex)
  ;

%{ - - - - - - - - - - - - - - - - - -
% More generally:

inductive LkupStr : (Î¨:tctx) (Î¨':tctx) {$S:$[Î¨ âŠ¢ Î¨']} [Î¨' âŠ¢ lctx] â†’ [Î¨ âŠ¢ tm] â†’ [ âŠ¢ tp] â†’ ctype = 
  | Lkp'/str : LkupExh [Î¨' âŠ¢ Î”] [Î¨' âŠ¢ X] [ âŠ¢ A]
    â†’ LkupStr $[Î¨ âŠ¢ $S] [Î¨' âŠ¢ Î”] [Î¨ âŠ¢ X[$S]] [ âŠ¢ A];

rec lkup_str : LkupExh [Î¨ âŠ¢ Î”] [Î¨ âŠ¢ #p] [ âŠ¢ A]
â†’ Rmv [Î¨] [Î¦] [Î¨ âŠ¢ Î”] [Î¨ âŠ¢ #q] [ âŠ¢ ğŸ˜] [ âŠ¢ B] $[Î¨ âŠ¢ $S] [Î¦ âŠ¢ Î”']
â†’ LkupStr $[Î¨ âŠ¢ $S] [Î¦ âŠ¢ Î”'] [Î¨ âŠ¢ #p] [ âŠ¢ A] = ? ;
%- - - - - - - - - - - - - - - - - - }%

inductive LkupToplin : (Î¨:tctx) [Î¨ âŠ¢ lctx] â†’ [Î¨ âŠ¢ tm] â†’ [ âŠ¢ tp] â†’ ctype = 
  | Lkp/toplin : Exh [Î¨ âŠ¢ Î”]
    â†’ LkupToplin [Î¨,x:tm âŠ¢ cons Î”[..] x T[] ğŸ™] [Î¨,x:tm âŠ¢ x] [ âŠ¢ T];

rec lkup_toplin : LkupExh [Î¨,x:tm âŠ¢ cons Î”[..] x T[] ğŸ™] [Î¨,x:tm âŠ¢ X] [ âŠ¢ T']
â†’ LkupToplin [Î¨,x:tm âŠ¢ cons Î”[..] x T[] ğŸ™] [Î¨,x:tm âŠ¢ X] [ âŠ¢ T'] =
  / total /
  fn l â‡’ case l of
  | Lkp/exh Rmv/t ex â‡’ Lkp/toplin ex
  | Lkp/exh (Rmv/c rm) ex â‡’ impossible ex
  ;