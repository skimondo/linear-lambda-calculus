%------------------------------------------------------%
% Terms and Types
%------------------------------------------------------%

LF tm : type =
| lam : (tm â†’ tm) â†’ tm
| app : tm â†’ tm â†’ tm;

LF tp : type =
| lolli : tp â†’ tp â†’ tp
| nat : tp;

schema tctx = tm;

inductive Eq : (Î¨:tctx) [Î¨ âŠ¢ tm] â†’ [Î¨ âŠ¢ tm] â†’ ctype = Eq/refl : Eq [Î¨ âŠ¢ M] [Î¨ âŠ¢ M];

%------------------------------------------------------%
% Typing contexts
%------------------------------------------------------%

LF lctx : type =
| nil : lctx
| cons : lctx â†’ tm â†’ tp â†’ mult â†’ lctx;

LF cx_eq : lctx â†’ lctx â†’ type = cx/refl : cx_eq Î” Î”;

%------------------------------------------------------%
% Main properties of typing contexts
%------------------------------------------------------%

% No linear assumptions occur in Î”

inductive Exh : (Î¨ : tctx) [Î¨ âŠ¢ lctx] â†’ ctype =
| Exh/n : Exh [ âŠ¢ nil]
| Exh/c : Exh [Î¨ âŠ¢ Î”] â†’ Exh [Î¨, x:tm âŠ¢ cons Î”[..] x _ ğŸ˜];

% Splitting / joining typing contexts: Î”â‚ â‹ˆ Î”â‚‚ = Î”

inductive Merge : (Î¨:tctx) [Î¨ âŠ¢ lctx] â†’ [Î¨ âŠ¢ lctx] â†’ [Î¨ âŠ¢ lctx] â†’ ctype =
| Mg/n : Merge [ âŠ¢ nil] [ âŠ¢ nil] [ âŠ¢ nil]
| Mg/c : Merge [Î¨ âŠ¢ Î”â‚] [Î¨ âŠ¢ Î”â‚‚] [Î¨ âŠ¢ Î”] â†’ [ âŠ¢ â€¢ Î±â‚ Î±â‚‚ Î±]
  â†’ Merge [Î¨, x:tm âŠ¢ cons Î”â‚[..] x A[] Î±â‚[]] [Î¨, x:tm âŠ¢ cons Î”â‚‚[..] x A[] Î±â‚‚[]] [Î¨, x:tm âŠ¢ cons Î”[..] x A[] Î±[]];

% Î”â§µ{X :^Î± A} = Î”'
% i.e., X appears in Î” with type A and multiplicity Î±, and 
% Î”' is the result of removing is from the context

inductive Rmv : (Î¨:tctx) [Î¨ âŠ¢ lctx] â†’ [Î¨ âŠ¢ tm] â†’ [ âŠ¢ tp] â†’ [ âŠ¢ mult] â†’ {Î¨':tctx} {$S:$[Î¨ âŠ¢ Î¨']} [Î¨' âŠ¢ lctx] â†’ ctype = 
| Rmv/t :
    Rmv [Î¨, x:tm âŠ¢ cons Î”[..] x A[] Î±[]]
        [Î¨, x:tm âŠ¢ x] [ âŠ¢ A] [ âŠ¢ Î±]
        [Î¨] $[Î¨,x:tm âŠ¢ ..] [Î¨ âŠ¢ Î”]
| Rmv/c : Rmv [Î¨ âŠ¢ Î”] [Î¨ âŠ¢ #p] [ âŠ¢ B] [ âŠ¢ Î²] [Î¦] $[Î¨ âŠ¢ $S] [Î¦ âŠ¢ Î”']
  â†’ Rmv [Î¨, x:tm âŠ¢ cons Î”[..] x A[] Î±[]]
        [Î¨, x:tm âŠ¢ #p[..]] [ âŠ¢ B] [ âŠ¢ Î²]
        [Î¦, x:tm] $[Î¨, x:tm âŠ¢ $S[..], x]
        [Î¦,x:tm âŠ¢ cons Î”'[..] x A[] Î±[]];

inductive Append : (Î¨:tctx) (Î¨':tctx) (Î¦:tctx) [Î¨ âŠ¢ lctx] â†’ [Î¨' âŠ¢ lctx] â†’ [Î¦ âŠ¢ lctx] â†’ ctype =
| App/n : Append [Î¨ âŠ¢ Î”] [ âŠ¢ nil] [Î¨ âŠ¢ Î”]
| App/c : Append [Î¨ âŠ¢ Î”] [Î¨' âŠ¢ Î”'] [Î¦ âŠ¢ Î”â‚€]
    â†’ Append [Î¨ âŠ¢ Î”] [Î¨', x:tm âŠ¢ cons Î”'[..] x A[] Î±[]] [Î¦, x:tm âŠ¢ cons Î”â‚€[..] x A[] Î±[]];

%{ - - - - - - - - - - - - - - - - - -
% Update type and/or multiplicity of variable

inductive Upd : (Î¨:tctx) [Î¨ âŠ¢ lctx] â†’ [Î¨ âŠ¢ tm] â†’ [ âŠ¢ tp] â†’ [ âŠ¢ mult] â†’ [ âŠ¢ tp] â†’ [ âŠ¢ mult] â†’ [Î¨ âŠ¢ lctx] â†’ ctype = 
| Upd/t :
    Upd [Î¨, x:tm âŠ¢ cons Î”[..] x A[] Î±[]]
        [Î¨, x:tm âŠ¢ x] [ âŠ¢ A] [ âŠ¢ Î±] [ âŠ¢ B] [ âŠ¢ Î²]
        [Î¨, x:tm âŠ¢ cons Î”[..] x B[] Î²[]]
| Upd/n :
    Upd [Î¨ âŠ¢ Î”] [Î¨ âŠ¢ X] [ âŠ¢ A] [ âŠ¢ Î±] [ âŠ¢ B] [ âŠ¢ Î²] [Î¨ âŠ¢ Î”']
  â†’ Upd [Î¨, x:tm âŠ¢ cons Î”[..] x C[] Î³[]]
        [Î¨, x:tm âŠ¢ x] [ âŠ¢ A] [ âŠ¢ Î±] [ âŠ¢ B] [ âŠ¢ Î²]
        [Î¨, x:tm âŠ¢ cons Î”'[..] x C[] Î³[]];
%- - - - - - - - - - - - - - - - - - }%

%------------------------------------------------------%
% Lookup directly defined for other properties
%------------------------------------------------------%

inductive LkupExh : (Î¨:tctx) [Î¨ âŠ¢ lctx] â†’ [Î¨ âŠ¢ tm] â†’ [ âŠ¢ tp] â†’ ctype = 
| Lkp/exh : Rmv [Î¨ âŠ¢ Î”] [Î¨ âŠ¢ #p] [ âŠ¢ A] [ âŠ¢ ğŸ™] [Î¦] $[Î¨ âŠ¢ $S] [Î¦ âŠ¢ Î”']
    â†’ Exh [Î¦ âŠ¢ Î”'] 
    â†’ LkupExh [Î¨ âŠ¢ Î”] [Î¨ âŠ¢ #p] [ âŠ¢ A];