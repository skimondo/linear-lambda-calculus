
% Linear contexts as lists of atoms and resource annotations
% DZ: arbitrary atoms or `hy x A`'s?

LF lctx : type =
| nil : lctx
| cons : lctx â†’ atm â†’ mult â†’ lctx;

LF cx_eq : lctx â†’ lctx â†’ type = cx/refl : cx_eq Î” Î”;

% `Unrestricted` qualifier

%{
LF unr_pair : atm â†’ mult â†’ type =
| up/u : {A:atm} unr_pair A ğŸ˜
| up/Ï‰ : {A:atm} unr_pair A Ï‰; % intuit assums
%| up/d : {X:name} unr_pair (hy X done) ğŸ™
}%

LF unr : lctx â†’ type =
| un/n : unr nil
| un/c : unr Î” â†’ mult_neq Î± lin â†’ unr (cons Î” A Î±);

% Splitting / merging linear contexts: Î”â‚ â‹ˆ Î”â‚‚ = Î”

LF merge : lctx â†’ lctx â†’ lctx â†’ type =
| mg/n : merge nil nil nil
| mg/c : merge Î”â‚ Î”â‚‚ Î” â†’ â€¢ Î±â‚ Î±â‚‚ Î± â†’ merge (cons Î”â‚ A Î±â‚) (cons Î”â‚‚ A Î±â‚‚) (cons Î” A Î±);

% Lookup and remove an element from a linear context

LF rmv : lctx â†’ atm â†’ mult â†’ lctx â†’ type =
| rmv/t : rmv (cons Î” A Î±) A Î± Î”
| rmv/n : rmv Î” A Î± Î”' â†’ rmv (cons Î” B Î²) A Î± (cons Î”' B Î²);

% Context well-formedness

false : type.

inductive Wf : (Î¨:ictx) {Î”:[Î¨ âŠ¢ lctx]} ctype =
| Wf/n : Wf [Î¨ âŠ¢ nil]
| Wf/c : Wf [Î¨ âŠ¢ Î”] â†’ ([Î¨ âŠ¢ lookup_name #p Î”] â†’ [ âŠ¢ false]) â†’ Wf [Î¨ âŠ¢ cons Î” (hy #p A[]) _];

inductive Wf_lin : (Î¨:ictx) {Î”:[Î¨ âŠ¢ lctx]} ctype =
| Wfl/n : Wf_lin [Î¨ âŠ¢ nil]
| Wfl/c : Wf_lin [Î¨ âŠ¢ Î”] â†’ ([Î¨ âŠ¢ lookup_name #p Î”] â†’ [ âŠ¢ false]) â†’ [ âŠ¢ mult_neq Î± Ï‰] â†’ Wf_lin [Î¨ âŠ¢ cons Î” (hy #p A[]) Î±[]];
