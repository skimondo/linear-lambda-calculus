%======================================================%
% Algebraic properties of multiplicities
% (linear systems with exponentials)
%======================================================%

% Remark: cancellativity does not hold since Ï‰ âˆ™ Î± = Ï‰ for any Î±

% Totality: For any Î±â‚, Î±â‚‚, there exists an Î± such that Î±â‚ âˆ™ Î±â‚‚ = Î±

LF getâˆ™ : mult â†’ mult â†’ type =
| get-âˆ™ : â€¢ Î±â‚ Î±â‚‚ Î± â†’ getâˆ™ Î±â‚ Î±â‚‚;

rec mult_total : {Î±â‚:[ âŠ¢ mult]} {Î±â‚‚:[ âŠ¢ mult]} [ âŠ¢ getâˆ™ Î±â‚ Î±â‚‚] =
  / total /
  mlam Î±â‚, Î±â‚‚ â‡’
  case [ âŠ¢ Î±â‚] of
  | [ âŠ¢ ğŸ˜] â‡’ [_ âŠ¢ get-âˆ™ â€¢/0-1]
  | [ âŠ¢ Ï‰] â‡’ [_ âŠ¢ get-âˆ™ â€¢/Ï‰-1]
  | [ âŠ¢ ğŸ™] â‡’
    case [ âŠ¢ Î±â‚‚] of
    | [ âŠ¢ ğŸ˜] â‡’ [ âŠ¢ get-âˆ™ â€¢/0-2]
    | [ âŠ¢ Ï‰] â‡’ [ âŠ¢ get-âˆ™ â€¢/Ï‰-2]
    | [ âŠ¢ ğŸ™] â‡’ [ âŠ¢ get-âˆ™ â€¢/1]
  ;

% Functionality: If Î±â‚ âˆ™ Î±â‚‚ = Î± and Î±â‚ âˆ™ Î±â‚‚ = Î±', then Î± = Î±'

rec mult_func : [ âŠ¢ â€¢ Î±â‚ Î±â‚‚ Î±] â†’ [ âŠ¢ â€¢ Î±â‚ Î±â‚‚ Î±'] â†’ [ âŠ¢ mult_eq Î± Î±'] =
  / total /
  fn MLT1, MLT2 â‡’ case MLT1 of 
  | [ âŠ¢ â€¢/0-1] â‡’
    (case MLT2 of
    | [ âŠ¢ â€¢/0-1] â‡’ [ âŠ¢ mult/refl]
    | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ mult/refl]
    | [ âŠ¢ â€¢/Ï‰-2] â‡’ [ âŠ¢ mult/refl]
    )
  | [ âŠ¢ â€¢/0-2] â‡’
    (case MLT2 of
    | [ âŠ¢ â€¢/0-1] â‡’ [ âŠ¢ mult/refl]
    | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ mult/refl]
    | [ âŠ¢ â€¢/Ï‰-1] â‡’ [ âŠ¢ mult/refl]
    )
  | [ âŠ¢ â€¢/1] â‡’ let [ âŠ¢ â€¢/1] = MLT2 in [ âŠ¢ mult/refl]
  | [ âŠ¢ â€¢/Ï‰-1] â‡’
    (case MLT2 of
    | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ mult/refl]
    | [ âŠ¢ â€¢/Ï‰-1] â‡’ [ âŠ¢ mult/refl]
    | [ âŠ¢ â€¢/Ï‰-2] â‡’ [ âŠ¢ mult/refl]
    )
  | [ âŠ¢ â€¢/Ï‰-2] â‡’
    (case MLT2 of
    | [ âŠ¢ â€¢/0-1] â‡’ [ âŠ¢ mult/refl]
    | [ âŠ¢ â€¢/Ï‰-1] â‡’ [ âŠ¢ mult/refl]
    | [ âŠ¢ â€¢/Ï‰-2] â‡’ [ âŠ¢ mult/refl]
    )
  ;

% Identity: 
% (1) If Î±â‚ âˆ™ Î±â‚‚ = Î± and Î±â‚ is an identity element, then Î±â‚‚ = Î±
% (2) For any Î±, obtain an identity element Î² such that Î² â€¢ Î± = Î±

rec mult_id : [ âŠ¢ â€¢ Î±â‚ Î±â‚‚ Î±] â†’ [ âŠ¢ ident Î±â‚] â†’ [ âŠ¢ mult_eq Î±â‚‚ Î±] =
  / total 1 /
  fn m, u â‡’
  let [ âŠ¢ ident/0] = u in
  case m of
  | [ âŠ¢ â€¢/0-1] â‡’ [ âŠ¢ mult/refl]
  | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ mult/refl]
  | [ âŠ¢ â€¢/Ï‰-2] â‡’ [ âŠ¢ mult/refl]
  ;

LF get_uâˆ™ : mult â†’ type =
| get-uâˆ™ : ident Î² â†’ â€¢ Î² Î± Î± â†’ get_uâˆ™ Î±;

rec mult_get_id : {Î±:[ âŠ¢ mult]} [ âŠ¢ get_uâˆ™ Î±] =
  / total /
  mlam _ â‡’ [ âŠ¢ get-uâˆ™ ident/0 â€¢/0-1]
  ;

% Zero-sum-freedom: If Î±â‚ âˆ™ Î±â‚‚ = Î± and Î± is an identity element, then Î±â‚ = Î±

rec mult_zsfree : [ âŠ¢ â€¢ Î±â‚ Î±â‚‚ Î±] â†’ [ âŠ¢ ident Î±] â†’ [ âŠ¢ mult_eq Î±â‚ Î±] =
  / total 1 /
  fn m, u â‡’ 
  let [ âŠ¢ ident/0] = u in
  case m of
  | [ âŠ¢ â€¢/0-1] â‡’ [ âŠ¢ mult/refl]
  | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ mult/refl]
  ;

% Commutativity: If Î±â‚ âˆ™ Î±â‚‚ = Î±, then Î±â‚‚ âˆ™ Î±â‚ = Î±

rec mult_comm : [ âŠ¢ â€¢ Î±â‚ Î±â‚‚ Î±] â†’ [ âŠ¢ â€¢ Î±â‚‚ Î±â‚ Î±] =
  / total /
  fn MLT â‡’ case MLT of 
  | [ âŠ¢ â€¢/0-1] â‡’ [ âŠ¢ â€¢/0-2]
  | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ â€¢/0-1]
  | [ âŠ¢ â€¢/1]   â‡’ [ âŠ¢ â€¢/1]
  | [ âŠ¢ â€¢/Ï‰-1] â‡’ [ âŠ¢ â€¢/Ï‰-2]
  | [ âŠ¢ â€¢/Ï‰-2] â‡’ [ âŠ¢ â€¢/Ï‰-1]
  ;

% Associativity: If (Î±â‚ â€¢ Î±â‚‚) â€¢ Î±â‚ƒ = Î±, then Î±â‚ â€¢ (Î±â‚‚ â€¢ Î±â‚ƒ) = Î±

LF â€¢assoc : â€¢ _ _ _ â†’ â€¢ _ _ _ â†’ type =
| â€¢/assoc : â€¢ Î±â‚‚ Î±â‚ƒ Î±â‚‚â‚ƒ â†’ â€¢ Î±â‚ Î±â‚‚â‚ƒ Î± â†’
            {MLT1:â€¢ Î±â‚ Î±â‚‚ Î±â‚â‚‚}{MLT2:â€¢ Î±â‚â‚‚ Î±â‚ƒ Î±} â€¢assoc MLT1 MLT2;

rec mult_assoc : {MLT1:[ âŠ¢ â€¢ Î±â‚ Î±â‚‚ Î±â‚â‚‚]} {MLT2:[ âŠ¢ â€¢ Î±â‚â‚‚ Î±â‚ƒ Î±]} [ âŠ¢ â€¢assoc MLT1 MLT2] =
  / total /
  mlam MLT1, MLT2 â‡’ case [ âŠ¢ MLT1] of 
  | [ âŠ¢ â€¢/0-1] â‡’ [ âŠ¢ â€¢/assoc MLT2 â€¢/0-1 _ _]
  | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/0-1 MLT2 _ _]
  | [ âŠ¢ â€¢/1] â‡’
    (case [ âŠ¢ MLT2] of
    | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/0-2 â€¢/1 _ _]
    | [ âŠ¢ â€¢/Ï‰-1]:[ âŠ¢ â€¢ _ Î±â‚ƒ _] â‡’
      (case mult_total [ âŠ¢ ğŸ™] [ âŠ¢ Î±â‚ƒ] of
      | [ âŠ¢ get-âˆ™ â€¢/0-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/0-2 â€¢/1 _ _]
      | [ âŠ¢ get-âˆ™ â€¢/1] â‡’ [ âŠ¢ â€¢/assoc â€¢/1 â€¢/Ï‰-2 _ _]
      | [ âŠ¢ get-âˆ™ â€¢/Ï‰-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/Ï‰-2 â€¢/Ï‰-2 _ _]
      )
    | [ âŠ¢ â€¢/Ï‰-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/Ï‰-2 â€¢/Ï‰-2 _ _]
    )
  | [ âŠ¢ â€¢/Ï‰-1]:[ âŠ¢ â€¢ _ Î±â‚‚ _] â‡’
    (case [ âŠ¢ MLT2] of
    | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/0-2 â€¢/Ï‰-1 _ _]
    | [ âŠ¢ â€¢/Ï‰-1]:[ âŠ¢ â€¢ _ Î±â‚ƒ _] â‡’
      let [ âŠ¢ get-âˆ™ MLT3] = mult_total [ âŠ¢ Î±â‚‚] [ âŠ¢ Î±â‚ƒ] in
      [ âŠ¢ â€¢/assoc MLT3 â€¢/Ï‰-1 _ _]
    | [ âŠ¢ â€¢/Ï‰-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/Ï‰-2 â€¢/Ï‰-1 _ _]
    )
  | [ âŠ¢ â€¢/Ï‰-2] â‡’
    (case [ âŠ¢ MLT2] of
    | [ âŠ¢ â€¢/0-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/Ï‰-1 â€¢/Ï‰-2 _ _]
    | [ âŠ¢ â€¢/Ï‰-1] â‡’ [ âŠ¢ â€¢/assoc â€¢/Ï‰-1 â€¢/Ï‰-2 _ _]
    | [ âŠ¢ â€¢/Ï‰-2] â‡’ [ âŠ¢ â€¢/assoc â€¢/Ï‰-1 â€¢/Ï‰-2 _ _]
    )
  ;

%------------------------------------------------------%
% Properties of unrestricted elements
%------------------------------------------------------%

% Technical lemmas about unrestricted elements (used to prove context lemmas)

rec mult_unr_id : [ âŠ¢ unr Î±] â†’ [ âŠ¢ â€¢ Î± Î± Î±] =
  / total /
  fn u â‡’ case u of
  | [ âŠ¢ unr/0] â‡’ [ âŠ¢ â€¢/0-1]
  | [ âŠ¢ unr/Ï‰] â‡’ [ âŠ¢ â€¢/Ï‰-1]
  ;

rec mult_ident_unr : [ âŠ¢ ident Î±] â†’ [ âŠ¢ unr Î±] =
  / total /
  fn u â‡’ let [ âŠ¢ ident/0] = u in [ âŠ¢ unr/0]
  ;
